<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>supermario63 - Flash Launcher</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Ruffle: Flash ì—ë®¬ë ˆì´í„° (CDN) -->
  <!-- ê¸°ë³¸ CDN -->
  <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
  <!-- ì˜ˆë¹„(ëŒ€ì²´) CDN: ê¸°ë³¸ CDN ì°¨ë‹¨/ì§€ì—°ì‹œ ìë™ ë¡œë“œ -->
  <script>
    (function ensureRuffle() {
      const onReady = () => {
        if (!window.RufflePlayer) {
          const s = document.createElement('script');
          s.src = "https://cdn.jsdelivr.net/npm/@ruffle-rs/ruffle";
          document.head.appendChild(s);
        }
      };
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", onReady);
      } else {
        onReady();
      }
    })();
  </script>

  <link rel="stylesheet" href="styles.css" />

  <!-- favicon ì„¤ì • (16x16 PNG) -->
  <link rel="icon" href="favicon.png" type="image/png" sizes="16x16" />

  <meta name="color-scheme" content="dark light">
</head>
<body>
  <header class="site-header">
    <h1>supermario63</h1>
    <p class="subtitle">Flash ì—ë®¬ë ˆì´í„°(Ruffle)ë¡œ ë¸Œë¼ìš°ì €ì—ì„œ ë°”ë¡œ í”Œë ˆì´</p>
  </header>

  <main class="container">
    <section class="player-card">
      <div class="player-toolbar">
        <button id="btnReload" class="btn" title="ë‹¤ì‹œ ë¡œë“œ">ğŸ”„ ë‹¤ì‹œ ë¡œë“œ</button>
        <button id="btnFullscreen" class="btn" title="ì „ì²´í™”ë©´ ì „í™˜">â›¶ ì „ì²´í™”ë©´</button>
        <label class="file-label" for="fileInput">
          ğŸ’¾ SWF íŒŒì¼ ì—´ê¸°
          <input id="fileInput" type="file" accept=".swf" />
        </label>
      </div>

      <!-- ë¬´ëŒ€ -->
      <div id="stage" class="stage" aria-label="ê²Œì„ ë¬´ëŒ€" tabindex="0"></div>

      <p class="hint">
        ê¸°ë³¸ìœ¼ë¡œ <code>assets/supermario63.swf</code>ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.<br/>
        ë‹¤ë¥¸ SWFë¥¼ ì‹œí—˜í•´ë³´ê³  ì‹¶ìœ¼ë©´ ìœ„ì˜ <b>SWF íŒŒì¼ ì—´ê¸°</b> ë²„íŠ¼ì„ ì‚¬ìš©í•˜ê±°ë‚˜ ë¬´ëŒ€ì— <b>ë“œë˜ê·¸&ë“œë¡­</b>í•˜ì„¸ìš”.<br/>
        â†‘â†“â†â†’, Space ë“± í‚¤ ì…ë ¥ì´ ì•ˆ ë¨¹ì„ ë• ë¬´ëŒ€ë¥¼ í•œ ë²ˆ í´ë¦­í•´ í¬ì»¤ìŠ¤ë¥¼ ì£¼ì„¸ìš”.
      </p>
    </section>

    <section class="faq">
      <details>
        <summary>ì‹¤í–‰ ì•ˆ ë  ë•Œ ì²´í¬ë¦¬ìŠ¤íŠ¸</summary>
        <ul>
          <li><b>íŒŒì¼ ê²½ë¡œ</b>: <code>assets/supermario63.swf</code> ê°€ ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸</li>
          <li><b>ì •ì  ì„œë²„</b>: ì¼ë¶€ ë¸Œë¼ìš°ì €ëŠ” <code>file://</code> ë¡œë“œ ì‹œ WASM/SWF ì ‘ê·¼ì„ ì œí•œí•©ë‹ˆë‹¤.<br/>
            ê°„ë‹¨í•œ ì„œë²„(ì˜ˆ: VSCode Live Server, ë˜ëŠ” í„°ë¯¸ë„ì—ì„œ <code>python -m http.server</code>)ë¡œ ì—´ì–´ì£¼ì„¸ìš”.</li>
          <li><b>ê°•ë ¥ ìƒˆë¡œê³ ì¹¨</b>: ìºì‹œ ë¬¸ì œì¼ ìˆ˜ ìˆì–´ Ctrl+F5 ì‹œë„</li>
        </ul>
      </details>
    </section>
  </main>

  <footer class="site-footer">
    <small>Â© 2025 Flash Game Launcher Â· Ruffle ê¸°ë°˜</small>
  </footer>

  <script>
    const stage = document.getElementById('stage');
    const fileInput = document.getElementById('fileInput');
    const btnReload = document.getElementById('btnReload');
    const btnFullscreen = document.getElementById('btnFullscreen');

    let rufflePlayer;
    let currentSrc = "assets/supermario63.swf";

    function createPlayer() {
      stage.innerHTML = "";
      stage.classList.remove('dragover');

      // Ruffle ìµœì‹  ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
      const ruffle = window.RufflePlayer?.newest?.();
      if (!ruffle) {
        stage.innerHTML = `
          <div class="error">
            <p>Ruffle ì´ˆê¸°í™” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>
            <p class="mono">RufflePlayer not ready</p>
          </div>`;
        return;
      }

      rufflePlayer = ruffle.createPlayer();
      rufflePlayer.classList.add("ruffle-player");
      stage.appendChild(rufflePlayer);

      // ë¬´ëŒ€ ì±„ìš°ê¸°
      rufflePlayer.style.width = "100%";
      rufflePlayer.style.height = "100%";

      // SWF ë¡œë“œ
      rufflePlayer.load(currentSrc).then(() => {
        // í‚¤ë³´ë“œ ì…ë ¥ í¬ì»¤ìŠ¤ í™•ë³´
        stage.focus();
      }).catch(err => {
        console.error("SWF ë¡œë“œ ì‹¤íŒ¨:", err);
        stage.innerHTML = `
          <div class="error">
            <p>SWF ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>
            <p class="mono">${escapeHtml(String(err))}</p>
            <p>ê²½ë¡œì™€ ì„œë²„ êµ¬ë™ ì—¬ë¶€ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
          </div>`;
      });
    }

    function escapeHtml(s) {
      return s
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    // íŒŒì¼ ì—´ê¸°
    fileInput.addEventListener('change', (e) => {
      const file = e.target.files?.[0];
      if (!file) return;
      const url = URL.createObjectURL(file);
      currentSrc = url;
      createPlayer();
    });

    // ë“œë˜ê·¸&ë“œë¡­
    stage.addEventListener('dragover', (e) => {
      e.preventDefault();
      stage.classList.add('dragover');
    });
    stage.addEventListener('dragleave', () => stage.classList.remove('dragover'));
    stage.addEventListener('drop', (e) => {
      e.preventDefault();
      stage.classList.remove('dragover');
      const file = e.dataTransfer?.files?.[0];
      if (file && file.name.toLowerCase().endsWith('.swf')) {
        const url = URL.createObjectURL(file);
        currentSrc = url;
        createPlayer();
      }
    });

    // ë‹¤ì‹œ ë¡œë“œ
    btnReload.addEventListener('click', () => createPlayer());

    // ì „ì²´í™”ë©´ (Ruffle ì „ìš© API ìš°ì„ )
    btnFullscreen.addEventListener('click', () => {
      if (!rufflePlayer) return;
      if (typeof rufflePlayer.enterFullscreen === 'function') {
        rufflePlayer.enterFullscreen();
      } else if (rufflePlayer.requestFullscreen) {
        rufflePlayer.requestFullscreen();
      } else if (stage.requestFullscreen) {
        stage.requestFullscreen();
      }
    });

    // í‚¤ë³´ë“œ í¬ì»¤ìŠ¤(í™”ì‚´í‘œ/ìŠ¤í˜ì´ìŠ¤ ë“± ì…ë ¥)
    stage.addEventListener('click', () => stage.focus());

    // ì´ˆê¸° ë¡œë“œ
    document.addEventListener('DOMContentLoaded', createPlayer);
  </script>
</body>
</html>
